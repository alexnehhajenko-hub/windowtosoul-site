<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>AI Photo ‚Üí Artwork</title>
  <link rel="stylesheet" href="/assets/style.css" />
</head>
<body>
  <div class="page">
    <header class="page-header">
      <h1>üé® AI Photo ‚Üí Artwork</h1>
      <p class="subtitle">
        –¢–µ—Å—Ç–æ–≤–∞—è –≤–µ—Ä—Å–∏—è: –º–∞—Å–ª—è–Ω—ã–π –ø–æ—Ä—Ç—Ä–µ—Ç.<br>
        –°–µ–π—á–∞—Å –¥–æ–±–∞–≤–∏–ª–∏ –∑–∞–≥—Ä—É–∑–∫—É —Ñ–æ—Ç–æ ‚Äî –º–æ–¥–µ–ª—å –ø–æ–∫–∞ —Ä–∏—Å—É–µ—Ç <strong>–ø–æ –æ–ø–∏—Å–∞–Ω–∏—é</strong>,
        –Ω–æ —Ñ–æ—Ç–æ —É–∂–µ –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç—Å—è –Ω–∞ —Å–µ—Ä–≤–µ—Ä (–ø–æ–¥–≥–æ—Ç–æ–≤–∫–∞ –∫ —Å—Ç–∏–ª–∏–∑–∞—Ü–∏–∏ –ø–æ —Ñ–æ—Ç–æ).
      </p>
    </header>

    <main class="card">
      <form id="artForm" class="form">
        <!-- 1. –§–æ—Ç–æ -->
        <div class="form-field">
          <label class="label">1. Upload photo (optional)</label>
          <input type="file" id="photoInput" accept="image/*" />
          <p class="hint">
            –§–æ—Ç–æ —Å–µ–π—á–∞—Å <strong>–Ω–µ –≤–ª–∏—è–µ—Ç</strong> –Ω–∞ —Ä–µ–∑—É–ª—å—Ç–∞—Ç ‚Äî —Ç–æ–ª—å–∫–æ —Ç–µ—Å—Ç–∏—Ä—É–µ–º –∑–∞–≥—Ä—É–∑–∫—É.
          </p>
        </div>

        <!-- 2. –û–ø–∏—Å–∞–Ω–∏–µ -->
        <div class="form-field">
          <label class="label">2. Extra description (optional)</label>
          <input
            type="text"
            id="promptInput"
            placeholder="For example: young woman in a yellow dress, soft warm light"
          />
        </div>

        <!-- –ö–Ω–æ–ø–∫–∞ -->
        <button type="submit" id="generateBtn" class="btn-primary">
          Generate portrait
        </button>

        <!-- –°—Ç–∞—Ç—É—Å -->
        <p id="statusText" class="status"></p>
      </form>

      <!-- –†–µ–∑—É–ª—å—Ç–∞—Ç -->
      <section class="result">
        <h2>Your artwork</h2>
        <div class="art-frame">
          <img id="resultImage" alt="AI artwork" style="display:none;" />
        </div>
      </section>
    </main>
  </div>

  <script>
    const form = document.getElementById("artForm");
    const photoInput = document.getElementById("photoInput");
    const promptInput = document.getElementById("promptInput");
    const statusText = document.getElementById("statusText");
    const resultImage = document.getElementById("resultImage");
    const generateBtn = document.getElementById("generateBtn");

    function fileToBase64(file) {
      return new Promise((resolve, reject) => {
        const reader = new FileReader();
        reader.onload = () => resolve(reader.result);
        reader.onerror = reject;
        reader.readAsDataURL(file);
      });
    }

    form.addEventListener("submit", async (e) => {
      e.preventDefault();

      statusText.textContent = "‚è≥ Generating‚Ä¶";
      resultImage.style.display = "none";
      generateBtn.disabled = true;

      try {
        let imageBase64 = null;

        if (photoInput.files && photoInput.files[0]) {
          const dataUrl = await fileToBase64(photoInput.files[0]);
          // dataUrl = "data:image/png;base64,AAAA..."
          const parts = dataUrl.split(",");
          imageBase64 = parts.length === 2 ? parts[1] : dataUrl;
        }

        const payload = {
          prompt: promptInput.value || "",
          style: "oil painting", // –ø–æ–∫–∞ –æ–¥–∏–Ω —Å—Ç–∏–ª—å, –ø–æ–∑–∂–µ –¥–æ–±–∞–≤–∏–º –≤—ã–±–æ—Ä —Å—Ç–∏–ª—è
          imageBase64,           // —Å–µ—Ä–≤–µ—Ä –ø–æ–∫–∞ —Ç–æ–ª—å–∫–æ –ª–æ–≥–∏—Ä—É–µ—Ç —ç—Ç–æ –ø–æ–ª–µ
        };

        const res = await fetch("/api/generate", {
          method: "POST",
          headers: {
            "Content-Type": "application/json",
          },
          body: JSON.stringify(payload),
        });

        const data = await res.json();

        if (!res.ok || !data.imageUrl) {
          throw new Error(data.error || "Generation failed");
        }

        resultImage.src = data.imageUrl;
        resultImage.style.display = "block";
        statusText.textContent = "";
      } catch (err) {
        console.error(err);
        statusText.textContent = "‚ùå Error: " + (err.message || "Generation failed");
      } finally {
        generateBtn.disabled = false;
      }
    });
  </script>
</body>
</html>
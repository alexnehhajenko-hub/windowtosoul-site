<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Window to Soul ‚Äì AI Portraits</title>
  <link rel="stylesheet" href="/assets/style.css" />
</head>
<body>
  <main class="page">
    <section class="card">
      <header class="card-header">
        <h1>üé® Window to Soul ‚Äì AI Portraits</h1>
        <p class="subtitle">
          –ó–∞–≥—Ä—É–∑–∏—Ç–µ —Ñ–æ—Ç–æ, –≤—ã–±–µ—Ä–∏—Ç–µ —Å—Ç–∏–ª—å –∏ –ø–æ–ª—É—á–∏—Ç–µ –∫—Ä–∞—Å–∏–≤—ã–π AI-–ø–æ—Ä—Ç—Ä–µ—Ç.<br />
          –°–µ–π—á–∞—Å —Ñ–æ—Ç–æ —Ç–µ—Ö–Ω–∏—á–µ—Å–∫–∏ –∑–∞–≥—Ä—É–∂–∞–µ—Ç—Å—è, –Ω–æ —Ä–µ–∑—É–ª—å—Ç–∞—Ç –µ—â—ë –∑–∞–≤–∏—Å–∏—Ç —Ç–æ–ª—å–∫–æ –æ—Ç —Å—Ç–∏–ª—è –∏ –æ–ø–∏—Å–∞–Ω–∏—è
          (img2img –¥–æ–±–∞–≤–∏–º —Å–ª–µ–¥—É—é—â–∏–º —à–∞–≥–æ–º).
        </p>
      </header>

      <form id="artForm" class="form">
        <!-- –§–æ—Ç–æ -->
        <div class="field">
          <label class="label">1. –ó–∞–≥—Ä—É–∑–∏—Ç–µ –≤–∞—à–µ —Ñ–æ—Ç–æ (–ø–æ–∫–∞ –Ω–µ–æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ)</label>
          <input type="file" id="photoInput" accept="image/*" />
          <p class="hint">
            –§–æ—Ç–æ —Å–µ–π—á–∞—Å –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç—Å—è –Ω–∞ —Å–µ—Ä–≤–µ—Ä, –Ω–æ –º–æ–¥–µ–ª—å –µ—â—ë —Ä–∞–±–æ—Ç–∞–µ—Ç –ø–æ —Ç–µ–∫—Å—Ç—É –∏ —Å—Ç–∏–ª—é.
            –ú—ã –ø–æ–¥–≥–æ—Ç–æ–≤–∏–º img2img –ø–æ—Å–ª–µ —Å—Ç–∞–±–∏–ª—å–Ω–æ–≥–æ –∑–∞–ø—É—Å–∫–∞.
          </p>
        </div>

        <!-- –°—Ç–∏–ª—å -->
        <div class="field">
          <label class="label">2. –í—ã–±–µ—Ä–∏—Ç–µ —Å—Ç–∏–ª—å</label>
          <div class="style-row">
            <label class="style-option">
              <input type="radio" name="style" value="oil" checked />
              <span>üñå –ú–∞—Å–ª–æ</span>
            </label>
            <label class="style-option">
              <input type="radio" name="style" value="anime" />
              <span>üå∏ –ê–Ω–∏–º–µ</span>
            </label>
            <label class="style-option">
              <input type="radio" name="style" value="fantasy" />
              <span>‚ú® Fantasy</span>
            </label>
            <label class="style-option">
              <input type="radio" name="style" value="realistic" />
              <span>üì∏ Realistic</span>
            </label>
          </div>
        </div>

        <!-- –û–ø–∏—Å–∞–Ω–∏–µ -->
        <div class="field">
          <label class="label">3. –î–æ–±–∞–≤—å—Ç–µ –¥–µ—Ç–∞–ª–∏ (–ø–æ –∂–µ–ª–∞–Ω–∏—é)</label>
          <input
            id="promptInput"
            class="text-input"
            placeholder="–ù–∞–ø—Ä–∏–º–µ—Ä: —Ç—ë–ø–ª—ã–π —Å–≤–µ—Ç, –≥–æ—Ä—ã, –∑–∞–∫–∞—Ç, –∑–æ–ª–æ—Ç–æ–µ –ø–ª–∞—Ç—å–µ‚Ä¶"
          />
        </div>

        <!-- –ö–Ω–æ–ø–∫–∞ -->
        <button type="submit" id="generateBtn" class="btn-primary">
          –°–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞—Ç—å –ø–æ—Ä—Ç—Ä–µ—Ç
        </button>
        <p id="statusText" class="status"></p>
      </form>

      <!-- –†–µ–∑—É–ª—å—Ç–∞—Ç -->
      <section class="result">
        <h2>Your artwork</h2>
        <div class="result-box" id="resultBox">
          <img id="resultImage" alt="AI artwork result" style="display:none;" />
        </div>
        <a id="downloadLink" href="#" download="portrait.png" class="download-link" style="display:none;">
          ‚¨á –°–∫–∞—á–∞—Ç—å –≤ —Ö–æ—Ä–æ—à–µ–º –∫–∞—á–µ—Å—Ç–≤–µ
        </a>
      </section>
    </section>
  </main>

  <script>
    const form = document.getElementById("artForm");
    const photoInput = document.getElementById("photoInput");
    const promptInput = document.getElementById("promptInput");
    const statusText = document.getElementById("statusText");
    const generateBtn = document.getElementById("generateBtn");
    const resultImage = document.getElementById("resultImage");
    const resultBox = document.getElementById("resultBox");
    const downloadLink = document.getElementById("downloadLink");

    function fileToBase64(file) {
      return new Promise((resolve, reject) => {
        const reader = new FileReader();
        reader.onload = () => resolve(reader.result);
        reader.onerror = reject;
        reader.readAsDataURL(file);
      });
    }

    form.addEventListener("submit", async (e) => {
      e.preventDefault();
      statusText.textContent = "‚è≥ –ì–µ–Ω–µ—Ä–∏—Ä—É–µ–º –ø–æ—Ä—Ç—Ä–µ—Ç‚Ä¶";
      generateBtn.disabled = true;
      resultImage.style.display = "none";
      downloadLink.style.display = "none";

      try {
        let imageBase64 = null;
        if (photoInput.files && photoInput.files[0]) {
          const dataUrl = await fileToBase64(photoInput.files[0]);
          const parts = dataUrl.split(",");
          imageBase64 = parts.length === 2 ? parts[1] : null;
        }

        const styleEl = document.querySelector('input[name="style"]:checked');
        const style = styleEl ? styleEl.value : "oil";

        const payload = {
          prompt: promptInput.value || "",
          style,
          imageBase64, // –ø–æ–∫–∞ –Ω–µ –∏—Å–ø–æ–ª—å–∑—É–µ–º –Ω–∞ –º–æ–¥–µ–ª–∏, –Ω–æ —É–∂–µ –¥–æ—Å—Ç–∞–≤–ª—è–µ–º –Ω–∞ —Å–µ—Ä–≤–µ—Ä
        };

        const res = await fetch("/api/generate", {
          method: "POST",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify(payload),
        });

        const data = await res.json().catch(() => ({}));

        if (!res.ok || !data.imageUrl) {
          throw new Error(data.error || "Generation failed");
        }

        resultImage.src = data.imageUrl;
        resultImage.style.display = "block";
        resultBox.classList.add("has-image");

        downloadLink.href = data.imageUrl;
        downloadLink.style.display = "inline-block";

        statusText.textContent = "";
      } catch (err) {
        console.error(err);
        statusText.textContent = "‚ùå –û—à–∏–±–∫–∞: " + (err.message || "–ù–µ —É–¥–∞–ª–æ—Å—å —Å–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞—Ç—å");
      } finally {
        generateBtn.disabled = false;
      }
    });
  </script>
</body>
</html>
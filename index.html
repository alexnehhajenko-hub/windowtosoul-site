<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>AI Photo ‚Üí Artwork</title>
  <link rel="stylesheet" href="style.css">
</head>

<body>
  <h1>üé® AI Photo ‚Üí Artwork</h1>

  <p>
    Upload your photo and get an AI-generated artwork.<br>
    <small>(–ï—Å–ª–∏ —Ñ–æ—Ç–æ –Ω–µ —Ä–∞–±–æ—Ç–∞–µ—Ç ‚Äî AI —Ä–∏—Å—É–µ—Ç –ø–æ –æ–ø–∏—Å–∞–Ω–∏—é.)</small>
  </p>

  <form id="artForm">
    <label>1. Upload photo (optional)</label><br>
    <input type="file" id="photo" accept="image/*"><br><br>

    <label>2. Choose style</label><br>
    <select id="style">
      <option value="oil painting">üñåÔ∏è Oil painting</option>
      <option value="fantasy art">‚ú® Fantasy art</option>
      <option value="realistic portrait">üì∏ Realistic portrait</option>
      <option value="anime portrait">üéå Anime style</option>
      <option value="classical art">üèõ Classical artist</option>
    </select><br><br>

    <label>3. Extra description (optional)</label><br>
    <input id="prompt" placeholder="For example: warm sunset, golden light"><br><br>

    <button type="submit">Generate Artwork</button>
  </form>

  <p id="status"></p>

  <h2>Your artwork</h2>
  <img id="resultImage" style="max-width: 90%; display: none;">
  <br>
  <a id="downloadLink" download="artwork.png" style="display: none;">Download</a>

  <script>
    const form = document.getElementById("artForm");
    const status = document.getElementById("status");
    const resultImage = document.getElementById("resultImage");
    const downloadLink = document.getElementById("downloadLink");

    // Convert file to Base64
    function toBase64(file) {
      return new Promise((resolve, reject) => {
        const reader = new FileReader();
        reader.onload = () => resolve(reader.result.split(",")[1]);
        reader.onerror = reject;
        reader.readAsDataURL(file);
      });
    }

    form.addEventListener("submit", async (e) => {
      e.preventDefault();
      status.textContent = "‚è≥ Generating‚Ä¶";
      resultImage.style.display = "none";
      downloadLink.style.display = "none";

      const photo = document.getElementById("photo").files[0];
      const style = document.getElementById("style").value;
      const promptText = document.getElementById("prompt").value;

      let imageBase64 = null;
      if (photo) imageBase64 = await toBase64(photo);

      try {
        const res = await fetch("/api/generate", {
          method: "POST",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify({
            imageBase64,
            style,
            promptText
          })
        });

        const data = await res.json();
        if (!res.ok) throw new Error(JSON.stringify(data.error));

        resultImage.src = data.output;
        resultImage.style.display = "block";

        downloadLink.href = data.output;
        downloadLink.style.display = "inline-block";
        status.textContent = "";
      } catch (err) {
        status.textContent = "‚ùå Error: " + err.message;
      }
    });
  </script>
</body>
</html>
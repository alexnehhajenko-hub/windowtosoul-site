<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>WindowToSoul ‚Ä¢ AI Photo ‚Üí Artwork</title>
  <link rel="stylesheet" href="assets/style.css" />
</head>
<body>
  <div class="page">
    <header class="header">
      <h1>üé® AI Photo ‚Üí Artwork</h1>
      <p class="subtitle">
        –¢–µ—Å—Ç–æ–≤–∞—è –≤–µ—Ä—Å–∏—è: 4 —Å—Ç–∏–ª—è –ø–æ—Ä—Ç—Ä–µ—Ç–æ–≤. –°–µ–π—á–∞—Å –º–æ–¥–µ–ª—å —Ä–∏—Å—É–µ—Ç <b>–ø–æ –æ–ø–∏—Å–∞–Ω–∏—é</b>.
        –§–æ—Ç–æ –ø–æ–∑–∂–µ –ø–æ–¥–∫–ª—é—á–∏–º –∫–∞–∫ —Å—Ç–∏–ª—å –ø–æ —Ñ–æ—Ç–æ.
      </p>
    </header>

    <main class="layout">
      <!-- –õ–µ–≤–∞—è –∫–æ–ª–æ–Ω–∫–∞: –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ -->
      <section class="card settings">
        <h2>1. –í—ã–±–µ—Ä–∏—Ç–µ —Å—Ç–∏–ª—å</h2>

        <div class="styles">
          <button class="style-btn active" data-style="oil">
            –ö–∞—Ä—Ç–∏–Ω–∞ –º–∞—Å–ª–æ–º
          </button>
          <button class="style-btn" data-style="anime">
            –ê–Ω–∏–º–µ-–ø–æ—Ä—Ç—Ä–µ—Ç
          </button>
          <button class="style-btn" data-style="poster">
            –ö–∏–Ω–æ-–ø–æ—Å—Ç–µ—Ä
          </button>
          <button class="style-btn" data-style="classic">
            –ö–ª–∞—Å—Å–∏—á–µ—Å–∫–∏–π —Ö—É–¥–æ–∂–Ω–∏–∫
          </button>
        </div>

        <h2>2. –û–ø–∏—à–∏—Ç–µ –∂–µ–ª–∞–µ–º—ã–π –ø–æ—Ä—Ç—Ä–µ—Ç</h2>
        <p class="hint">
          –ù–∞–ø—Ä–∏–º–µ—Ä: <i>–º–æ–ª–æ–¥–∞—è –∂–µ–Ω—â–∏–Ω–∞ –≤ –∂—ë–ª—Ç–æ–º –ø–ª–∞—Ç—å–µ, —Ç—ë–ø–ª—ã–π —Å–≤–µ—Ç, —Ñ–æ–Ω –∫–∞–∫ —É –†–µ–º–±—Ä–∞–Ω–¥—Ç–∞</i>
        </p>
        <textarea id="prompt" rows="3" placeholder="–í–∞—à–µ –æ–ø–∏—Å–∞–Ω–∏–µ (–º–æ–∂–Ω–æ –ø–æ-—Ä—É—Å—Å–∫–∏)..."></textarea>

        <!-- –ó–∞–≥–æ—Ç–æ–≤–∫–∞ –ø–æ–¥ —Ñ–æ—Ç–æ (–ø–æ–∫–∞ —Ç–æ–ª—å–∫–æ UI, –Ω–∞ –±—ç–∫–µ–Ω–¥ –Ω–µ —É—Ö–æ–¥–∏—Ç) -->
        <h2>3. –§–æ—Ç–æ (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)</h2>
        <p class="hint small">
          –§–æ—Ç–æ —Å–µ–π—á–∞—Å <b>–Ω–µ –≤–ª–∏—è–µ—Ç</b> –Ω–∞ —Ä–µ–∑—É–ª—å—Ç–∞—Ç ‚Äî —Ç–æ–ª—å–∫–æ –≥–æ—Ç–æ–≤–∏–º –∑–∞–≥—Ä—É–∑–∫—É.
        </p>
        <input type="file" id="photo" accept="image/*" />

        <button id="generateBtn" class="primary-btn">
          –°–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞—Ç—å –ø–æ—Ä—Ç—Ä–µ—Ç
        </button>

        <p id="status" class="status"></p>
      </section>

      <!-- –ü—Ä–∞–≤–∞—è –∫–æ–ª–æ–Ω–∫–∞: —Ä–µ–∑—É–ª—å—Ç–∞—Ç -->
      <section class="card result">
        <h2>–í–∞—à —Ä–µ–∑—É–ª—å—Ç–∞—Ç</h2>
        <div id="imageFrame" class="image-frame">
          <p class="placeholder">
            –ó–¥–µ—Å—å –ø–æ—è–≤–∏—Ç—Å—è –ø–æ—Ä—Ç—Ä–µ—Ç –ø–æ—Å–ª–µ –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏.
          </p>
          <img id="resultImage" alt="AI artwork" />
        </div>

        <a id="downloadLink" class="download-link" href="#" download="artwork.png">
          –°–∫–∞—á–∞—Ç—å –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ
        </a>
      </section>
    </main>

    <footer class="footer">
      <p>WindowToSoul ‚Ä¢ —Ç–µ—Å—Ç–æ–≤—ã–π —Å—Ç–µ–Ω–¥ –¥–ª—è 4 —Å—Ç–∏–ª–µ–π (Replicate + FLUX)</p>
    </footer>
  </div>

  <script>
    // --- –ö–æ–Ω—Å—Ç–∞–Ω—Ç—ã —Å—Ç–∏–ª–µ–π (—Ç–æ–ª—å–∫–æ —Ç–µ–∫—Å—Ç, —Ñ–æ—Ç–æ –ø–æ–∫–∞ –Ω–µ –∏—Å–ø–æ–ª—å–∑—É–µ–º) ---
    const STYLE_PRESETS = {
      oil: "oil painting portrait, warm soft cinematic light, detailed brush strokes, rich colors, masterpiece, 4k",
      anime: "anime style portrait, clean line art, soft shading, vibrant colours, detailed eyes, portrait, 4k",
      poster: "cinematic movie poster portrait, dramatic lighting, high contrast, film look, detailed face, 4k",
      classic: "classical painter portrait, inspired by Rembrandt and Vermeer, soft warm light, realistic, oil on canvas, 4k"
    };

    let currentStyle = "oil";

    const styleButtons = document.querySelectorAll(".style-btn");
    const promptEl = document.getElementById("prompt");
    const statusEl = document.getElementById("status");
    const generateBtn = document.getElementById("generateBtn");
    const resultImage = document.getElementById("resultImage");
    const imageFrame = document.getElementById("imageFrame");
    const downloadLink = document.getElementById("downloadLink");

    // –ü–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ —Å—Ç–∏–ª–µ–π
    styleButtons.forEach((btn) => {
      btn.addEventListener("click", () => {
        styleButtons.forEach((b) => b.classList.remove("active"));
        btn.classList.add("active");
        currentStyle = btn.dataset.style;
      });
    });

    // –ö–ª–∏–∫ –ø–æ "–°–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞—Ç—å"
    generateBtn.addEventListener("click", async () => {
      const userText = (promptEl.value || "").trim();

      if (!userText) {
        alert("–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –æ–ø–∏—à–∏—Ç–µ –ø–æ—Ä—Ç—Ä–µ—Ç (–º–æ–∂–Ω–æ –æ–¥–Ω–æ –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏–µ).");
        return;
      }

      const base = STYLE_PRESETS[currentStyle] || STYLE_PRESETS.oil;
      const fullPrompt = base + ", " + userText;

      statusEl.textContent = "‚è≥ –ì–µ–Ω–µ—Ä–∞—Ü–∏—è‚Ä¶ 15‚Äì30 —Å–µ–∫—É–Ω–¥";
      statusEl.className = "status loading";
      generateBtn.disabled = true;

      // –ü–æ–∫–∞ —Ñ–æ—Ç–æ –Ω–µ –æ—Ç–ø—Ä–∞–≤–ª—è–µ–º ‚Äî —Ä–∞–±–æ—Ç–∞–µ–º —Ç–æ–ª—å–∫–æ —Å —Ç–µ–∫—Å—Ç–æ–º
      const payload = {
        style: currentStyle,
        prompt: fullPrompt
      };

      try {
        const res = await fetch("/api/generate", {
          method: "POST",
          headers: {
            "Content-Type": "application/json"
          },
          body: JSON.stringify(payload)
        });

        const data = await res.json();

        if (!res.ok || !data.imageUrl) {
          const msg = (data && (data.error || data.details)) || "Server error";
          throw new Error(msg);
        }

        // –ü–æ–∫–∞–∑–∞—Ç—å –∫–∞—Ä—Ç–∏–Ω–∫—É
        resultImage.src = data.imageUrl;
        resultImage.style.display = "block";
        imageFrame.classList.add("has-image");

        // –°–∫–∞—á–∞—Ç—å
        downloadLink.href = data.imageUrl;
        downloadLink.style.display = "inline-block";

        statusEl.textContent = "‚úÖ –ì–æ—Ç–æ–≤–æ!";
        statusEl.className = "status success";
      } catch (err) {
        console.error(err);
        statusEl.textContent = "‚ùå –û—à–∏–±–∫–∞: " + err.message;
        statusEl.className = "status error";
      } finally {
        generateBtn.disabled = false;
      }
    });
  </script>
</body>
</html>